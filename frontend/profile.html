<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyBeats | Profile Hub</title>
    <link rel="stylesheet" href="profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <div class="background-elements">
        <div class="circle circle-1"></div>
        <div class="circle circle-2"></div>
    </div>

    <nav class="top-bar">
        <div class="nav-content">
            <h1 class="logo" onclick="location.href='../dashboard/dashboard.html'">Study<span>Beats</span></h1>
            
            <div class="nav-right">
                <div id="liveClock" class="clock">00:00:00</div>
                <button class="btn-logout" onclick="handleLogout()">Logout</button>
            </div>
        </div>
    </nav>

    <main class="profile-container">
        <section class="profile-card hero-section">
            <div class="hero-left">
                <div class="avatar-box" id="avatarContainer">
                    <img id="profileImage" src="" style="display:none; width:100%; height:100%; object-fit:cover; border-radius:40px;">
                    <span id="avatarLetter">?</span>
                </div>
                <div class="user-info">
                    <div class="name-row">
                        <h1 id="displayUsername">Loading...</h1>
                        <button class="edit-pill" onclick="openEditModal()">Edit Profile</button>
                    </div>
                    <p id="displayEmail" class="email-sub">user@studybeats.com</p>
                    <p id="currentDate" class="date-sub">Loading Date...</p>
                </div>
            </div>
        </section>

        <section class="stats-row">
            <div class="profile-card stat-item">
                <label>Total Focus</label>
                <h2 id="totalTime">0h 0m</h2>
            </div>
            <div class="profile-card stat-item streak-highlight">
                <label>Day Streak</label>
                <h2 id="streakCount">0</h2>
            </div>
        </section>

        <section class="profile-card heatmap-section">
            <div class="heatmap-header">
                <h3>Productivity Momentum</h3>
                <p id="totalTasksText">Loading activity...</p>
            </div>
            <div class="heatmap-container">
                <div id="heatmapGrid" class="heatmap-grid"></div>
            </div>
            <div class="heatmap-legend">
                <span>Less</span>
                <div class="legend-squares">
                    <div class="square level-0"></div>
                    <div class="square level-1"></div>
                    <div class="square level-2"></div>
                    <div class="square level-3"></div>
                    <div class="square level-4"></div>
                </div>
                <span>More</span>
            </div>
        </section>

        <section class="features-grid">
            <div class="profile-card feature-tile" onclick="location.href='./library/library.html'" style="cursor:pointer; border-color: #1db954;">
                <i class="fas fa-folder-open icon" style="color: #1db954;"></i>
                <h3>Library</h3>
                <span class="badge" style="background: rgba(29, 185, 84, 0.2); color: #1db954;">Active</span>
            </div>

            <div class="profile-card feature-tile" onclick="location.href='./todo/todo.html'" style="cursor:pointer; border-color: #1db954;">
                <i class="fas fa-list-check icon" style="color: #1db954;"></i>
                <h3>To-Do</h3>
                <span class="badge" style="background: rgba(29, 185, 84, 0.2); color: #1db954;">Active</span>
            </div>

            <div class="profile-card feature-tile" onclick="location.href='buddies/buddies.html'" style="cursor:pointer; border-color: #1db954;">
                <i class="fas fa-users icon" style="color: #1db954;"></i>
                <h3>Buddies</h3>
                <span class="badge" style="background: rgba(29, 185, 84, 0.2); color: #1db954;">Active</span>
            </div>
        </section>
    </main>

    <div id="editModal" class="modal-overlay">
        <div class="modal-box">
            <h3>Edit Profile</h3>
            <div class="image-upload-section">
                <label for="imageInput" class="upload-label">
                    <i class="fas fa-camera"></i> Change Photo
                </label>
                <input type="file" id="imageInput" accept="image/*" hidden>
                <p id="fileNameDisplay" style="font-size: 12px; color: #1db954; margin-top: 5px;"></p>
            </div>
            <input type="text" id="newUsernameInput" placeholder="New Username">
            <div class="modal-btns">
                <button class="btn-cancel" onclick="closeEditModal()">Cancel</button>
                <button class="btn-save" id="saveBtn" onclick="saveProfile()">Save Changes</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="global.js"></script>
    <script src="profile-script.js"></script>
    <script src="player-component.js"></script>
</body>
</html>